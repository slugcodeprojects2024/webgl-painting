<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGL Painting</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        #canvas {
            border: 1px solid #000;
            background-color: #000;
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 500px;
            background-color: #fff;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .control-group {
            margin-bottom: 10px;
        }
        .control-row {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .control-row label {
            width: 120px;
            font-weight: bold;
        }
        .button-group {
            display: flex;
            gap: 10px;
        }
        button {
            padding: 8px 12px;
            border: none;
            background-color: #4CAF50;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        button.selected {
            background-color: #2196F3;
        }
        button#clearCanvas {
            background-color: #f44336;
        }
        button#clearCanvas:hover {
            background-color: #d32f2f;
        }
        button#drawPicture {
            background-color: #9c27b0;
        }
        button#drawPicture:hover {
            background-color: #7b1fa2;
        }
        .slider-container {
            display: flex;
            align-items: center;
            width: 100%;
        }
        .slider-container label {
            width: 120px;
            font-weight: bold;
        }
        .slider-container input {
            flex-grow: 1;
        }
        .slider-value {
            width: 30px;
            text-align: right;
            margin-left: 10px;
        }
        #advancedFeatures {
            margin-top: 20px;
            padding: 10px;
            border: 1px dashed #2196F3;
            border-radius: 5px;
            background-color: #e3f2fd;
        }
    </style>
</head>
<body>
    <h1>WebGL Painting Application</h1>
    
    <canvas id="canvas" width="500" height="500"></canvas>
    
    <div class="controls">
        <div class="control-group">
            <h3>Drawing Mode:</h3>
            <div class="button-group">
                <button id="pointsBtn" class="selected">Points</button>
                <button id="trianglesBtn">Triangles</button>
                <button id="circlesBtn">Circles</button>
                <button id="clearCanvas">Clear Canvas</button>
                <button id="drawPicture">Draw Picture</button>
            </div>
        </div>
        
        <div class="control-group">
            <h3>Shape Color:</h3>
            <div class="slider-container">
                <label for="redSlider">Red:</label>
                <input type="range" id="redSlider" min="0" max="1" step="0.01" value="1">
                <span class="slider-value" id="redValue">1.0</span>
            </div>
            <div class="slider-container">
                <label for="greenSlider">Green:</label>
                <input type="range" id="greenSlider" min="0" max="1" step="0.01" value="0">
                <span class="slider-value" id="greenValue">0.0</span>
            </div>
            <div class="slider-container">
                <label for="blueSlider">Blue:</label>
                <input type="range" id="blueSlider" min="0" max="1" step="0.01" value="0">
                <span class="slider-value" id="blueValue">0.0</span>
            </div>
        </div>
        
        <div class="control-group">
            <div class="slider-container">
                <label for="sizeSlider">Shape Size:</label>
                <input type="range" id="sizeSlider" min="1" max="50" value="10">
                <span class="slider-value" id="sizeValue">10</span>
            </div>
        </div>
        
        <div class="control-group">
            <div class="slider-container">
                <label for="segmentsSlider">Circle Segments:</label>
                <input type="range" id="segmentsSlider" min="3" max="36" value="12">
                <span class="slider-value" id="segmentsValue">12</span>
            </div>
        </div>
        
        <div id="advancedFeatures">
            <h3>Advanced Features:</h3>
            <ul>
                <li>Alpha transparency control for creating layered effects</li>
                <li>Brush stroke alignment with movement direction</li>
                <li>Continuous line drawing to fill gaps during mouse drag</li>
                <li>Download your artwork as an image</li>
            </ul>
            <div class="slider-container">
                <label for="alphaSlider">Transparency:</label>
                <input type="range" id="alphaSlider" min="0" max="1" step="0.01" value="1">
                <span class="slider-value" id="alphaValue">1.0</span>
            </div>
            <div class="button-group">
                <button id="downloadBtn" onclick="saveCanvasAsImage()">Download Artwork</button>
                <button id="rainbowModeBtn" onclick="toggleRainbowMode()">Rainbow Mode</button>
                <button id="startGameBtn" onclick="shapeCatcherGame.start()" style="background-color: #FF9800;">Start Mini-Game</button>
            </div>
        </div>
    </div>

    <!-- Vertex Shader -->
    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec4 a_Position;
        attribute vec4 a_Color;
        uniform float u_PointSize;
        varying vec4 v_Color;
        void main() {
            gl_Position = a_Position;
            gl_PointSize = u_PointSize;
            v_Color = a_Color;
        }
    </script>

    <!-- Fragment Shader -->
    <script id="fragment-shader" type="x-shader/x-fragment">
        precision mediump float;
        varying vec4 v_Color;
        void main() {
            gl_FragColor = v_Color;
        }
    </script>

    <script src="advanced_features.js"></script>
    <script src="main.js"></script>
    
    <div id="inspirationImage" style="margin-top: 20px; display: none;">
        <h3>Original Design (for triangle drawing assignment)</h3>
        <img id="drawingReference" alt="Triangle Drawing Reference" width="300">
    </div>

    <script>
        // Make sure this script runs after everything else has loaded
        window.addEventListener('load', function() {
          console.log("Adding direct button handlers...");
          
          // Download button
          document.getElementById('downloadBtn').addEventListener('click', function() {
            console.log("Download button clicked");
            // Direct implementation without relying on external functions
            const canvas = document.getElementById('canvas');
            const link = document.createElement('a');
            link.download = 'webgl-painting.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
          });
          
          // Rainbow Mode button
          document.getElementById('rainbowModeBtn').addEventListener('click', function() {
            console.log("Rainbow button clicked");
            // Direct implementation
            window.rainbowMode = !window.rainbowMode;
            this.textContent = window.rainbowMode ? 'Disable Rainbow' : 'Rainbow Mode';
            this.style.backgroundColor = window.rainbowMode ? '#FF4081' : '#4CAF50';
          });
          
          // Simple mini-game as fallback
          document.getElementById('startGameBtn').addEventListener('click', function() {
            console.log("Game button clicked");
            
            // Simple game fallback if the complex one isn't working
            alert("Starting a simple shape catching game!");
            
            // Clean slate for the game
            window.shapesList = [];
            renderAllShapes();
            
            // Game variables
            let score = 0;
            let gameTime = 30;
            let gameActive = true;
            
            // Create simple UI
            const gameUI = document.createElement('div');
            gameUI.id = 'gameUI';
            gameUI.style.position = 'absolute';
            gameUI.style.top = '20px';
            gameUI.style.left = '50%';
            gameUI.style.transform = 'translateX(-50%)';
            gameUI.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
            gameUI.style.color = 'white';
            gameUI.style.padding = '10px';
            gameUI.style.borderRadius = '5px';
            gameUI.style.zIndex = '1000';
            
            const scoreDisplay = document.createElement('div');
            scoreDisplay.textContent = 'Score: 0';
            gameUI.appendChild(scoreDisplay);
            
            const timeDisplay = document.createElement('div');
            timeDisplay.textContent = 'Time: 30s';
            gameUI.appendChild(timeDisplay);
            
            document.body.appendChild(gameUI);
            
            // Create a basket
            const basket = {
              x: 0,
              y: -0.8,
              width: 0.2,
              height: 0.1
            };
            
            // Follow mouse with basket
            const canvas = document.getElementById('canvas');
            function moveBasket(event) {
              if (!gameActive) return;
              const rect = canvas.getBoundingClientRect();
              const x = ((event.clientX - rect.left) / canvas.width) * 2 - 1;
              basket.x = x;
            }
            
            canvas.addEventListener('mousemove', moveBasket);
            
            // Falling shapes
            let fallingShapes = [];
            
            function spawnShape() {
              if (!gameActive) return;
              
              // Random position at top
              const x = Math.random() * 1.8 - 0.9;
              
              // Random color
              const r = Math.random();
              const g = Math.random();
              const b = Math.random();
              
              // Add shape
              fallingShapes.push({
                x: x,
                y: 1.0,
                color: [r, g, b],
                size: 20,
                speed: Math.random() * 0.01 + 0.005
              });
            }
            
            // Game loop
            function gameLoop() {
              if (!gameActive) return;
              
              // Clear canvas
              gl.clear(gl.COLOR_BUFFER_BIT);
              
              // Draw basket
              const basketVertices = [
                [basket.x - basket.width/2, basket.y - basket.height/2],
                [basket.x - basket.width/2, basket.y + basket.height/2],
                [basket.x + basket.width/2, basket.y + basket.height/2],
                
                [basket.x - basket.width/2, basket.y - basket.height/2],
                [basket.x + basket.width/2, basket.y + basket.height/2],
                [basket.x + basket.width/2, basket.y - basket.height/2]
              ];
              
              const vertexBuffer = gl.createBuffer();
              gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
              gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(basketVertices.flat()), gl.STATIC_DRAW);
              gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0);
              gl.enableVertexAttribArray(a_Position);
              gl.vertexAttrib4f(a_Color, 1.0, 1.0, 1.0, 1.0);
              gl.drawArrays(gl.TRIANGLES, 0, 6);
              gl.disableVertexAttribArray(a_Position);
              
              // Update and draw falling shapes
              for (let i = 0; i < fallingShapes.length; i++) {
                const shape = fallingShapes[i];
                
                // Move shape down
                shape.y -= shape.speed;
                
                // Draw the shape as a circle
                gl.vertexAttrib3f(a_Position, shape.x, shape.y, 0.0);
                gl.vertexAttrib4f(a_Color, shape.color[0], shape.color[1], shape.color[2], 1.0);
                gl.uniform1f(u_PointSize, shape.size);
                gl.drawArrays(gl.POINTS, 0, 1);
                
                // Check if caught by basket
                if (shape.y <= basket.y + basket.height/2 && 
                    shape.y >= basket.y - basket.height/2 &&
                    shape.x >= basket.x - basket.width/2 &&
                    shape.x <= basket.x + basket.width/2) {
                  
                  // Caught! Add score
                  score += 10;
                  scoreDisplay.textContent = `Score: ${score}`;
                  
                  // Remove shape
                  fallingShapes.splice(i, 1);
                  i--;
                  continue;
                }
                
                // Remove shapes that are off-screen
                if (shape.y < -1.2) {
                  fallingShapes.splice(i, 1);
                  i--;
                }
              }
              
              // Occasionally spawn new shapes
              if (Math.random() < 0.05) {
                spawnShape();
              }
              
              // Update game time
              gameTime -= 1/60; // Assuming 60fps
              if (gameTime <= 0) {
                endGame();
                return;
              }
              
              timeDisplay.textContent = `Time: ${Math.ceil(gameTime)}s`;
              
              // Continue game loop
              requestAnimationFrame(gameLoop);
            }
            
            function endGame() {
              gameActive = false;
              
              // Show final score
              alert(`Game Over! Your score: ${score}`);
              
              // Remove game UI
              document.body.removeChild(gameUI);
              
              // Remove event listener
              canvas.removeEventListener('mousemove', moveBasket);
              
              // Clear falling shapes
              fallingShapes = [];
              
              // Reset canvas
              renderAllShapes();
            }
            
            // Start the game loop
            gameLoop();
          });
        });
    </script>
</body>
</html>
``` 